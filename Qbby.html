<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Chatbot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column; /* To stack chat-box and input-container */
            justify-content: flex-end; /* Push content to bottom */
            align-items: center;
            height: 100vh;
            background-size: contain; /* Ensure the full image is visible */
            background-repeat: no-repeat;
            background-position: center bottom; /* Position image at bottom center */
            background-color: #f0f2f5; /* Fallback background color */
            transition: background-image 0.1s ease-in-out; /* Smooth transition for image changes */
            position: relative; /* For absolute positioning of chat box */
        }

        .chat-box {
            position: absolute; /* Position it over the background image */
            top: 20px; /* Adjust as needed */
            width: 350px; /* Adjust to fit the likely talk bubble area of your image */
            height: 400px; /* Adjust height for chat messages */
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background for readability */
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* Adjust message styles slightly to fit the new context */
        .message {
            padding: 8px 12px;
            border-radius: 18px;
            margin-bottom: 8px;
            max-width: 85%; /* Give a bit more room */
            word-wrap: break-word;
            font-size: 0.9em;
        }

        .user-message {
            background-color: #007bff;
            color: #fff;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            background-color: #e9e9eb;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .input-container {
            position: absolute; /* Position it over the background image */
            bottom: 20px; /* Adjust as needed, ensure it's below the background image base */
            width: 380px; /* Make it slightly wider than chat box if desired */
            display: flex;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent background */
            border-radius: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 15;
        }

        #user-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
            outline: none;
            font-size: 1em;
        }

        #send-btn {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1em;
        }

        #send-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body id="chatbot-body">

    <div id="chat-box" class="chat-box">
        <div class="message bot-message">Hello! I am an image bot. Ask me something!</div>
    </div>

    <div class="input-container">
        <input type="text" id="user-input" placeholder="Type your message...">
        <button id="send-btn">Send</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatbotBody = document.getElementById('chatbot-body');
            const chatBox = document.getElementById('chat-box');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');

            const responses = {
                'hello': 'Hello there! How can I help you?',
                'how are you': 'I am a computer program, but I am doing great! Thanks for asking.',
                'what is your name': 'I don\'t have a name, but you can call me Bot.',
                'help': 'I can answer simple questions. Try asking about my name or how I am doing.',
                'bye': 'Goodbye! Have a great day.',
                'default': 'I am sorry, I do not understand. Try asking something else.'
            };

            const talkImages = [
                'https://qottlebup.nekoweb.org/Talk-1.png',
                'https://qottlebup.nekoweb.org/Talk-2.png',
                'https://qottlebup.nekoweb.org/Talk-3.png',
                'https://qottlebup.nekoweb.org/Talk-4.png'
            ];
            const noSpeakImage = 'https://qottlebup.nekoweb.org/nospeek.png';

            let speakingAnimationInterval;

            function startSpeakingAnimation() {
                let i = 0;
                speakingAnimationInterval = setInterval(() => {
                    chatbotBody.style.backgroundImage = `url('${talkImages[i]}')`;
                    i = (i + 1) % talkImages.length;
                }, 150); // Cycle every 150ms
            }

            function stopSpeakingAnimation() {
                clearInterval(speakingAnimationInterval);
                chatbotBody.style.backgroundImage = `url('${noSpeakImage}')`;
            }

            function addMessage(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', `${sender}-message`);
                messageDiv.textContent = message;
                chatBox.appendChild(messageDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }

            function getBotResponse(userMessage) {
                const lowerCaseMessage = userMessage.toLowerCase().trim();
                for (const keyword in responses) {
                    if (lowerCaseMessage.includes(keyword)) {
                        return responses[keyword];
                    }
                }
                return responses['default'];
            }

            function sendMessage() {
                const userMessage = userInput.value;
                if (userMessage.trim() === '') return;

                addMessage(userMessage, 'user');
                userInput.value = '';

                // Bot starts "speaking" while waiting to respond
                startSpeakingAnimation();

                setTimeout(() => {
                    const botResponse = getBotResponse(userMessage);
                    addMessage(botResponse, 'bot');
                    stopSpeakingAnimation(); // Bot stops "speaking" after responding
                }, 1200); // Increased delay to 1.2 seconds to allow animation to be seen
            }

            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Initialize bot body background
            chatbotBody.style.backgroundImage = `url('${noSpeakImage}')`;
        });
    </script>
</body>
</html>